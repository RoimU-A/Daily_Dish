# Daily Dish アプリケーション企画書（v3）

## 1. プロジェクト概要

### 1.1 プロジェクト名
Daily Dish - 日々の料理生活を支える食材購入サポートアプリケーション

### 1.2 目的
家庭料理におけるレシピ管理と、ネットスーパーでの食材購入を自動化することで、ユーザーの日常的な料理生活を支援する。

### 1.3 プロジェクト背景
- 忙しい現代人にとって、食材購入の効率化は重要な課題
- 既存のレシピアプリと食材購入の分離により、ユーザー体験が断片化
- レシピから食材リストを自動生成し、購入までを一元化するニーズ

## 2. ターゲット

### 2.1 ターゲットユーザー
- **メインターゲット**: 家庭料理レベルの初心者
- **利用場面**: 日常的に料理をする個人
- **ニーズ**: レシピ管理と食材購入の効率化

### 2.2 ユーザー特性
- 料理レベル: 初心者〜中級者
- 年齢層: 20〜50代
- 利用デバイス: スマートフォン、タブレット、PC

## 3. 機能概要

### 3.1 主要機能

#### 機能1: レシピ管理機能
- **目的**: 料理レシピの登録・管理
- **機能詳細**: 
  - 既存レシピ（URL参照）の登録
  - 新規レシピ（独自レシピ）の詳細登録
  - 料理履歴の管理

#### 機能2: レシピからネットスーパーのカートへ食材を追加
- **対象サービス**: イオンネットスーパー
- **処理方法**: スクレイピング技術を使用
- **選択基準**: 価格が安い商品を優先
- **確認プロセス**: ユーザー確認必須

### 3.2 レシピデータ入力方式

#### 統一されたレシピ管理
- **入力**: レシピ名、材料情報、URL（オプション）
- **処理**: 外部アプリケーションでURL→テキスト変換（既存レシピの場合）
- **本アプリ**: 全レシピ情報を`recipes`テーブルに登録
- **URL管理**: 
  - 既存レシピ: URLフィールドにレシピサイトURL
  - 新規レシピ: URLフィールドはNULL

## 4. 技術仕様

### 4.1 アプリケーション形態
- **基本形態**: Webアプリケーション
- **入力方法**: 
  - **🆕 Webアプリケーション**: フロントエンドからの直接入力
  - **🆕 LineBot経由**: LINEからのレシピ情報取得
- **デザイン**: レスポンシブデザイン対応

### 4.2 システム構成
- **フロントエンド**: React + TypeScript Webアプリケーション
- **バックエンド**: Django REST API
- **外部連携**: イオンネットスーパー（スクレイピング）
- **🆕 入力インターフェース**: Webアプリ + LineBot

### 4.3 ユーザー管理
- **アカウント制**: 個人アカウント制（1アカウント1ユーザー）
- **🆕 LINE連携**: LINEアカウントとアプリユーザーの紐づけ機能
- **拡張性**: 必要に応じて機能追加可能

## 🆕 **5. LINE連携機能（v3新機能）**

### 5.1 LINE連携概要
- **目的**: 外部アプリの一部機能を当アプリに移管
- **対象機能**: レシピ登録機能の一部をLINEBotから実行可能に

### 5.2 LINE連携フロー

#### ユーザー紐づけ機能
1. LINEから「ユーザー紐づけ」メッセージ送信
2. 次のメッセージで当アプリのユーザーIDを送信
3. LINEユーザーIDとアプリユーザーIDを紐づけ

#### レシピ登録機能（2パターン対応）

##### パターン1: 既存レシピ（URL）
1. LINEBotから「ユーザーID」と「URL」を取得
2. URLを外部API（開発中）に送信してレシピ情報を取得
3. 取得したレシピ名・材料情報をDBに登録

##### パターン2: 新規レシピ（テキスト情報）
1. LINEBotから「ユーザーID」と「テキスト情報」を取得
2. テキスト情報からレシピ名・材料・量を解析
3. 解析した情報をDBに登録

### 5.3 テキストフォーマット仕様
```
レシピ:○○
材料:材料1、材料2、、、、
量:量1、量2、、、、
```

### 5.4 未連携ユーザー対応
- **方針**: 自動ユーザー作成は行わない
- **対応**: レシピ登録時に未連携の場合、ユーザー登録依頼を返答

## 6. 開発計画

### 6.1 段階的開発アプローチ

#### 第1段階: 基本レシピ管理機能 ✅
- **機能1**: テキスト情報のデータベース登録機能
- **機能2**: ユーザー新規レシピ登録機能
- **機能3**: データベースからのレシピ情報取得機能
- **機能4**: 料理履歴管理機能

#### 第2段階: 食材表示機能 ✅
- **機能5**: ユーザーの選択した食材を表示する機能
- **詳細**: 材料情報をキャッシュして管理、カート追加前の食材情報表示ページ

#### 🆕 **第3段階: LINE連携機能**
- **機能6**: LINEユーザー紐づけ機能
- **機能7**: LINEからのレシピ登録機能
- **機能8**: テキスト解析機能
- **機能9**: 外部URL解析API連携枠組み

#### 第4段階: ネットスーパー連携機能
- **機能10**: イオンネットスーパーへのカート追加機能
- **技術**: スクレイピング技術を使用
- **処理**: ユーザー指定時に実行、実行後はキャッシュ削除

### 6.2 開発時検討事項
- **食材マッピング**: レシピ材料名とネットスーパー商品名の対応精度
- **スクレイピング**: 技術的安定性の確保
- **🆕 LINE API**: LINE Bot API の安定的な運用

## 7. 期待効果

### 7.1 ユーザーメリット
- **効率化**: レシピ管理から食材購入まで一元化
- **時間短縮**: 食材購入の自動化による時間節約
- **経済効果**: 価格比較による食費削減
- **料理促進**: 手軽な食材調達による料理頻度向上
- **🆕 利便性向上**: LINEからの手軽なレシピ登録

### 7.2 技術的価値
- **スクレイピング技術**: EC連携の技術実証
- **データ統合**: レシピと食材購入の統合管理
- **ユーザビリティ**: 直感的な操作性の実現
- **🆕 マルチチャネル**: Web + LINE の複数入力経路

## 8. リスク分析

### 8.1 技術的リスク
- **スクレイピング**: サイト仕様変更による機能停止リスク
- **食材マッピング**: 商品名対応の精度課題
- **API制限**: 外部サービス利用制限
- **🆕 LINE連携**: LINE API の仕様変更リスク

### 8.2 対応策
- **スクレイピング**: 定期的な監視とメンテナンス体制
- **マッピング**: 機械学習による精度向上の検討
- **外部連携**: 複数サービス対応による冗長性確保
- **🆕 LINE運用**: 定期的なAPI仕様確認とアップデート対応

## 9. 成功指標

### 9.1 定量指標
- **ユーザー数**: 月間アクティブユーザー数
- **利用頻度**: 週次利用率
- **機能利用率**: 各機能の使用率
- **データ精度**: 食材マッピング成功率
- **🆕 LINE利用率**: LINE経由でのレシピ登録率

### 9.2 定性指標
- **ユーザー満足度**: アンケート調査結果
- **使いやすさ**: ユーザビリティテスト結果
- **継続利用**: リテンション率

## 10. 今後の展開

### 10.1 機能拡張
- **複数スーパー対応**: イオン以外のネットスーパー連携
- **AI機能**: レシピ推薦システム
- **SNS連携**: 料理記録の共有機能
- **栄養管理機能**: 将来的な健康管理機能追加
- **🆕 LINEリッチ機能**: LINE Rich Menu、Flex Message対応

### 10.2 事業展開
- **パートナーシップ**: 食材宅配サービスとの連携
- **データ活用**: レシピデータの分析・提供サービス
- **マネタイズ**: プレミアム機能の追加

## 11. 削除された機能

### 11.1 栄養管理機能（削除理由）
- **当初計画**: レシピから栄養を管理する機能
- **削除理由**: 開発スコープの簡素化、コア機能への集中
- **将来対応**: 第5段階として将来的に追加検討可能

## 🆕 **12. v3での主要変更点**

### 12.1 LINE連携機能の追加
- **新機能**: LINEBotからのレシピ登録機能
- **ユーザー管理**: LINEアカウント連携機能
- **入力方式**: Web + LINE のマルチチャネル対応

### 12.2 データベース変更
#### User テーブル
- **追加フィールド**: `line_user_id`（VARCHAR(100), UNIQUE, NULL可）
- **用途**: LINEアカウントとの紐づけ管理

#### Recipe テーブル
- **変更なし**: 既存の材料・量・単位フィールド構造で対応可能

### 12.3 新規API追加
- **エンドポイント1**: `/api/external/recipes/from-line/` - LINEからのレシピ登録
- **エンドポイント2**: `/api/external/users/link-line/` - ユーザー紐づけ
- **認証方式**: API Key認証（External API）

### 12.4 テキスト解析機能
- **対応フォーマット**: 
  - URL形式（既存レシピ）
  - テキスト形式（新規レシピ）
  - ユーザー紐づけコマンド
- **解析ロジック**: 形式判定 → データ抽出 → DB登録

### 12.5 外部連携準備
- **URL解析API**: 外部開発中のAPI連携枠組み準備
- **将来対応**: API完成後の連携実装

### 12.6 機能の共存
- **Webアプリ**: 既存のレシピ登録機能維持
- **LINEBot**: 新規追加のレシピ登録機能
- **データ統合**: 両方からの登録を同一テーブルで管理

---

**v3企画承認後、LINE連携機能の実装に着手予定**